<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Inkscape Les 1: Selecteren en slepen</title>
    <link rel="stylesheet" href="src/style.css">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/branding/favicon_128.png">
      <!-- Font Awesome for mouse/interaction icons in the tutorial panel -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  </head>
  <body>
    <div id="toolbar">
      <div class="brand">
        <img src="assets/branding/MaakBib_Logo_LeftRight.svg" alt="MaakBib Logo" style=" vertical-align: middle;">
        Inkscape Les 1: Selecteren en slepen
      </div>
      <div class="buttons">
        <!-- Top controls removed for this lesson — navigation is via the left toolbar and instructions -->
      </div>
    </div>

    <div id="app">
      <div id="leftToolbar">
        <!-- Group 1: select, node, booleans -->
        <button class="tool-btn active" id="tool-select" title="Select" aria-label="Select tool" type="button"><img src="assets/icons/tool-pointer.svg" alt="Select"></button>
        <button class="tool-btn" id="tool-node" title="Node" aria-label="Node tool" type="button"><img src="assets/icons/tool-node-editor.svg" alt="Node"></button>
        <button class="tool-btn" id="tool-booleans" title="Booleans" aria-label="Boolean operations" type="button"><img src="assets/icons/draw-booleans.svg" alt="Booleans"></button>
        <div class="tool-sep"></div>

        <!-- Group 2: shapes -->
        <button class="tool-btn" id="tool-rect" title="Rectangle" aria-label="Rectangle" type="button"><img src="assets/icons/draw-rectangle.svg" alt="Rectangle"></button>
        <button class="tool-btn" id="tool-ellipse" title="Ellipse" aria-label="Ellipse" type="button"><img src="assets/icons/draw-ellipse.svg" alt="Ellipse"></button>
        <button class="tool-btn" id="tool-star" title="Star" aria-label="Star" type="button"><img src="assets/icons/draw-polygon-star.svg" alt="Star"></button>
        <button class="tool-btn" id="tool-spiral" title="Spiral" aria-label="Spiral" type="button"><img src="assets/icons/draw-spiral.svg" alt="Spiral"></button>
        <div class="tool-sep"></div>

        <!-- Group 3: draw/text -->
        <button class="tool-btn" id="tool-pen" title="Pen" aria-label="Pen tool" type="button"><img src="assets/icons/draw-path.svg" alt="Pen"></button>
        <button class="tool-btn" id="tool-text" title="Text" aria-label="Text tool" type="button"><img src="assets/icons/draw-text.svg" alt="Text"></button>
        <div class="tool-sep"></div>

        <!-- Group 4: spray/eraser/measure/zoom -->
        <!-- Removed spray and eraser for the lesson — they won't be interactive -->
        <button class="tool-btn" id="tool-measure" title="Measure" aria-label="Measure tool" type="button"><img src="assets/icons/tool-measure.svg" alt="Measure"></button>
        <button class="tool-btn" id="tool-zoom" title="Zoom" aria-label="Zoom tool" type="button"><img src="assets/icons/zoom.svg" alt="Zoom"></button>
      </div>
      
      <!-- Node Edit Context Toolbar - positioned next to leftToolbar -->
      <div id="nodeToolbar" class="node-toolbar hidden">
        <button id="btn-node-add" class="node-tool-btn" title="Add node">
          <img src="assets/icons/node_editing/node-add.svg" alt="Add node">
        </button>
        <button id="btn-node-delete" class="node-tool-btn" title="Delete node">
          <img src="assets/icons/node_editing/node-delete.svg" alt="Delete node">
        </button>
        <div class="toolbar-sep"></div>
        <button id="btn-node-cusp" class="node-tool-btn" title="Make corner (cusp)">
          <img src="assets/icons/node_editing/node-type-cusp.svg" alt="Corner">
        </button>
        <button id="btn-node-smooth" class="node-tool-btn" title="Make smooth">
          <img src="assets/icons/node_editing/node-type-smooth.svg" alt="Smooth">
        </button>
        <button id="btn-node-auto-smooth" class="node-tool-btn" title="Make auto-smooth">
          <img src="assets/icons/node_editing/node-type-auto-smooth.svg" alt="Auto-smooth">
        </button>
        <div class="toolbar-sep"></div>
        <button id="btn-make-line" class="node-tool-btn" title="Make segment straight">
          <img src="assets/icons/node_editing/node-segment-line.svg" alt="Make line">
        </button>
        <button id="btn-make-curve" class="node-tool-btn" title="Make segment curved">
          <img src="assets/icons/node_editing/node-segment-curve.svg" alt="Make curve">
        </button>
      </div>
      
      <canvas id="c"></canvas>
      <aside id="panel">
        <h3>Opdracht</h3>
        <p>Help het uiltje zich klaar te maken voor de maakplaats!</p>
        <p>Zet de helm op zijn hoofd.</p>
        <ul>
          <li><img src="assets/icons/left-click.svg" alt="Left click" style="width:20px;height:20px;vertical-align:middle">&nbsp; Linker muisknop: Selecteer de helm</li>
          <li><i class="fa-solid fa-arrows-up-down-left-right"></i>&nbsp; Klik en sleep om te verplaatsen</li>
          <li><i class="fa-solid fa-hand-pointer"></i>&nbsp; Laat los om te plaatsen</li>
        </ul>
      </aside>
    </div>

    <script>
      // Patch CanvasRenderingContext2D to set willReadFrequently for Fabric.js
      // This prevents the "Canvas2D: Multiple readback operations" warning
      (function() {
        const originalGetContext = HTMLCanvasElement.prototype.getContext;
        HTMLCanvasElement.prototype.getContext = function(contextType, contextAttributes) {
          if (contextType === '2d') {
            contextAttributes = contextAttributes || {};
            contextAttributes.willReadFrequently = true;
          }
          return originalGetContext.call(this, contextType, contextAttributes);
        };
      })();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/fabric@5.2.4/dist/fabric.min.js"></script>
    <script>
      // Normalize invalid Canvas textBaseline values that some libraries may set
      // (e.g. 'alphabetical' -> 'alphabetic') to avoid repeated console warnings.
      (function() {
        try {
          const proto = CanvasRenderingContext2D && CanvasRenderingContext2D.prototype;
          if (!proto) return;

          const originalDesc = Object.getOwnPropertyDescriptor(proto, 'textBaseline');
          const originalGetter = originalDesc && originalDesc.get;
          const originalSetter = originalDesc && originalDesc.set;

          Object.defineProperty(proto, 'textBaseline', {
            configurable: true,
            enumerable: true,
            get: function() {
              if (originalGetter) return originalGetter.call(this);
              return this._patchedTextBaseline || 'alphabetic';
            },
            set: function(v) {
              const mapped = (v === 'alphabetical') ? 'alphabetic' : v;
              if (originalSetter) return originalSetter.call(this, mapped);
              this._patchedTextBaseline = mapped;
            }
          });
        } catch (e) {
          // If patching fails, silently ignore — it's non-critical
          console.warn('[index.html] Failed to patch textBaseline mapping:', e);
        }
      })();
    </script>
    <script type="module" src="src/main.js"></script>
  </body>
</html>
