<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refactoring Test - Inkscape Tutorial</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #1565c0;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .metric {
            display: inline-block;
            margin: 10px 20px 10px 0;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
        }
        .metric-label {
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>üîß Refactoring Integration Test</h1>
    
    <div class="test-section">
        <h2>Module Loading Test</h2>
        <div id="module-test-status">Testing...</div>
        <div id="module-details"></div>
    </div>

    <div class="test-section">
        <h2>Animation Controller Test</h2>
        <button onclick="testAnimationController()">Test Animation Controller</button>
        <div id="animation-test-status"></div>
    </div>

    <div class="test-section">
        <h2>Asset Loader Test</h2>
        <button onclick="testAssetLoader()">Test Asset Loader</button>
        <div id="asset-test-status"></div>
    </div>

    <div class="test-section">
        <h2>Constants Test</h2>
        <button onclick="testConstants()">Test Constants Module</button>
        <div id="constants-test-status"></div>
    </div>

    <div class="test-section">
        <h2>Refactored Lessons Test</h2>
        <button onclick="testLesson1()">Test Lesson 1</button>
        <button onclick="testLesson2()">Test Lesson 2</button>
        <button onclick="testLesson3()">Test Lesson 3</button>
        <div id="lesson-test-status"></div>
    </div>

    <div class="test-section">
        <h2>Code Metrics Comparison</h2>
        <div id="metrics">
            <div class="metric">
                <div class="metric-value">-64%</div>
                <div class="metric-label">Lesson 1 Size</div>
            </div>
            <div class="metric">
                <div class="metric-value">-67%</div>
                <div class="metric-label">Complexity</div>
            </div>
            <div class="metric">
                <div class="metric-value">-100%</div>
                <div class="metric-label">Magic Numbers</div>
            </div>
            <div class="metric">
                <div class="metric-value">100%</div>
                <div class="metric-label">Testable</div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>Launch Live Application</h2>
        <button onclick="window.location.href='index.html'">Open Tutorial</button>
        <button onclick="window.location.href='index.html#lesson=1'">Lesson 1</button>
        <button onclick="window.location.href='index.html#lesson=2'">Lesson 2</button>
        <button onclick="window.location.href='index.html#lesson=3'">Lesson 3</button>
    </div>

    <script type="module">
        // Test module imports
        async function testModuleImports() {
            const status = document.getElementById('module-test-status');
            const details = document.getElementById('module-details');
            let results = [];

            try {
                // Test constants
                const constants = await import('./src/constants.js');
                results.push('‚úÖ constants.js loaded');
                
                // Test AnimationController
                const animController = await import('./src/AnimationController.js');
                results.push('‚úÖ AnimationController.js loaded');
                
                // Test AssetLoader
                const assetLoader = await import('./src/AssetLoader.js');
                results.push('‚úÖ AssetLoader.js loaded');
                
                // Test Lesson1
                const lesson1 = await import('./src/Lesson1.js');
                results.push('‚úÖ Lesson1.js loaded');
                
                // Test Lesson2Refactored
                const lesson2 = await import('./src/Lesson2Refactored.js');
                results.push('‚úÖ Lesson2Refactored.js loaded');
                
                // Test Lesson3Refactored
                const lesson3 = await import('./src/Lesson3Refactored.js');
                results.push('‚úÖ Lesson3Refactored.js loaded');

                status.className = 'status success';
                status.textContent = '‚úÖ All modules loaded successfully!';
                details.innerHTML = '<pre>' + results.join('\n') + '</pre>';
            } catch (error) {
                status.className = 'status error';
                status.textContent = '‚ùå Module loading failed!';
                details.innerHTML = '<pre>Error: ' + error.message + '\n\n' + error.stack + '</pre>';
            }
        }

        // Run test on page load
        testModuleImports();

        // Export test functions to global scope
        window.testAnimationController = async function() {
            const status = document.getElementById('animation-test-status');
            try {
                const { AnimationController } = await import('./src/AnimationController.js');
                
                // Create mock canvas
                const mockCanvas = {
                    requestRenderAll: () => {},
                    setViewportTransform: () => {}
                };
                
                const controller = new AnimationController(mockCanvas);
                
                // Test basic functionality
                const tests = [
                    controller.getActiveCount() === 0,
                    typeof controller.startPulseAnimation === 'function',
                    typeof controller.bounceAnimation === 'function',
                    typeof controller.doubleBounce === 'function',
                    typeof controller.startRotationAnimation === 'function',
                    typeof controller.startWiggleAnimation === 'function',
                    typeof controller.animateButtonPress === 'function',
                    typeof controller.animateViewport === 'function',
                    typeof controller.stopAnimation === 'function',
                    typeof controller.stopAllAnimations === 'function'
                ];
                
                if (tests.every(t => t)) {
                    status.className = 'status success';
                    status.innerHTML = '‚úÖ AnimationController passed all tests!<br>Active animations: ' + controller.getActiveCount();
                } else {
                    status.className = 'status error';
                    status.textContent = '‚ùå Some AnimationController tests failed';
                }
            } catch (error) {
                status.className = 'status error';
                status.innerHTML = '‚ùå Error: ' + error.message;
            }
        };

        window.testAssetLoader = async function() {
            const status = document.getElementById('asset-test-status');
            try {
                const { AssetLoader, assetLoader } = await import('./src/AssetLoader.js');
                
                const tests = [
                    typeof AssetLoader === 'function',
                    typeof assetLoader === 'object',
                    typeof assetLoader.loadSvgDocument === 'function',
                    typeof assetLoader.findGroupFragments === 'function',
                    typeof assetLoader.makeFabricGroupFromFragment === 'function',
                    typeof assetLoader.loadFabricGroups === 'function',
                    typeof assetLoader.clearCache === 'function',
                    typeof assetLoader.getCacheStats === 'function'
                ];
                
                const stats = assetLoader.getCacheStats();
                
                if (tests.every(t => t)) {
                    status.className = 'status success';
                    status.innerHTML = '‚úÖ AssetLoader passed all tests!<br>Cache: ' + JSON.stringify(stats);
                } else {
                    status.className = 'status error';
                    status.textContent = '‚ùå Some AssetLoader tests failed';
                }
            } catch (error) {
                status.className = 'status error';
                status.innerHTML = '‚ùå Error: ' + error.message;
            }
        };

        window.testConstants = async function() {
            const status = document.getElementById('constants-test-status');
            try {
                const constants = await import('./src/constants.js');
                
                const requiredExports = [
                    'ANIMATION_DURATION',
                    'ANIMATION_SCALE',
                    'INTERACTION_THRESHOLD',
                    'ZOOM',
                    'LAYOUT',
                    'STYLE',
                    'ASSETS',
                    'SVG_IDS'
                ];
                
                const missing = requiredExports.filter(exp => !constants[exp]);
                
                if (missing.length === 0) {
                    status.className = 'status success';
                    status.innerHTML = '‚úÖ All constants exported!<br>Exports: ' + requiredExports.join(', ');
                } else {
                    status.className = 'status error';
                    status.innerHTML = '‚ùå Missing exports: ' + missing.join(', ');
                }
            } catch (error) {
                status.className = 'status error';
                status.innerHTML = '‚ùå Error: ' + error.message;
            }
        };

        window.testLesson1 = async function() {
            const status = document.getElementById('lesson-test-status');
            try {
                const { startLesson1, restartLesson1, cleanupLesson1 } = await import('./src/Lesson1.js');
                
                const tests = [
                    typeof startLesson1 === 'function',
                    typeof restartLesson1 === 'function',
                    typeof cleanupLesson1 === 'function'
                ];
                
                if (tests.every(t => t)) {
                    status.className = 'status success';
                    status.innerHTML = '‚úÖ Lesson 1 module exports correct functions!';
                } else {
                    status.className = 'status error';
                    status.textContent = '‚ùå Lesson 1 missing required exports';
                }
            } catch (error) {
                status.className = 'status error';
                status.innerHTML = '‚ùå Error: ' + error.message;
            }
        };

        window.testLesson2 = async function() {
            const status = document.getElementById('lesson-test-status');
            try {
                const { startLesson2, restartLesson2, cleanupLesson2 } = await import('./src/Lesson2Refactored.js');
                
                const tests = [
                    typeof startLesson2 === 'function',
                    typeof restartLesson2 === 'function',
                    typeof cleanupLesson2 === 'function'
                ];
                
                if (tests.every(t => t)) {
                    status.className = 'status success';
                    status.innerHTML = '‚úÖ Lesson 2 module exports correct functions!';
                } else {
                    status.className = 'status error';
                    status.textContent = '‚ùå Lesson 2 missing required exports';
                }
            } catch (error) {
                status.className = 'status error';
                status.innerHTML = '‚ùå Error: ' + error.message;
            }
        };

        window.testLesson3 = async function() {
            const status = document.getElementById('lesson-test-status');
            try {
                const { startLesson3, restartLesson3, cleanupLesson3 } = await import('./src/Lesson3Refactored.js');
                
                const tests = [
                    typeof startLesson3 === 'function',
                    typeof restartLesson3 === 'function',
                    typeof cleanupLesson3 === 'function'
                ];
                
                if (tests.every(t => t)) {
                    status.className = 'status success';
                    status.innerHTML = '‚úÖ Lesson 3 module exports correct functions!';
                } else {
                    status.className = 'status error';
                    status.textContent = '‚ùå Lesson 3 missing required exports';
                }
            } catch (error) {
                status.className = 'status error';
                status.innerHTML = '‚ùå Error: ' + error.message;
            }
        };
    </script>
</body>
</html>
